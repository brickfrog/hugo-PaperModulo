<head>
    <meta name="microBlogUrl" content="{{ site.Params.homeInfoParams.MicroBlog.Url }}">
</head>

<header class="entry-header">
    {{- with site.Params.homeInfoParams.MicroBlog -}}
    <h3>{{ .Title }}</h4>
        <h6>{{ .Subtitle }}</h6>
        {{- end -}}
</header>
<div id="microBlog">
    <!-- Placeholder for the list of items -->
</div>

<script>
    function stripTags(str) {
        // Remove HTML tags and trim the result, a bit ugly but works
        return str.replace(/<[^>]+>|&rsquo;|&ldquo;|&rdquo;|&rsquo;|&rsquo;/ig, "").trim();
    }

    function getData() {
        var microBlogUrl = document.querySelector("meta[name='microBlogUrl']").getAttribute("content");
        fetch(microBlogUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                } else {
                    return response.json();
                }
            })
            .then(data => {
                // Get the container element
                const container = document.getElementById("microBlog");
                // Iterate over the first five items
                data.items.slice(0, 5).forEach(item => {
                    // Create a new div container
                    const div = document.createElement("div");
                    div.classList.add("container");
                    // Create a new link
                    const date = new Date(item.date_published);
                    const link = document.createElement("a");
                    link.classList.add("micro-link");
                    link.href = item.url;
                    link.innerHTML = date.toISOString().slice(0, 10) + ":";
                    // Create a new paragraph
                    const content = document.createElement("p");
                    content.classList.add("micro-content");
                    content.innerText = stripTags(item.content_html).substring(0, 150) + "...";
                    // Append the link and the content to the div container
                    div.appendChild(link);
                    div.appendChild(content);
                    // Append the div container to the microBlog container
                    container.appendChild(div);
                });
            })
            .catch(error => console.error("Error:", error));
    }

    getData();
</script>